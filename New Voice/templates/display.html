

<!DOCTYPE html>
<html>
	
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet"  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

	<title>Send Email</title>
</head>
{% block content%}
<body>

	<div class="container-fluid">
    <h1>SEND EMAIL</h1>
    <form id="audio-form" method="POST" action="{% url 'mail' %}">
      {% csrf_token %}
      <div class="form-group">
        <label for="to">To:</label>
        <input type="email" class="form-control" id="to" name="to_email" placeholder="Enter email">
      </div>
      <div class="form-group">
        <button id="record-button" type="button">Record</button>
        <button id="stop-button" type="button" disabled>Stop</button>
        <input type="hidden" id="audio-data" name="audio_data">
        <textarea class="form-control" rows="10" id="transcription-text" placeholder="Transcribed text" name="transcription">{{transcription}}</textarea>
      </div>
      <button type="submit">Send</button>
    </form>
  </div>
  
  <script>
  const recordButton = document.getElementById("record-button");
  const stopButton = document.getElementById("stop-button");
  const audioDataInput = document.getElementById("audio-data");
  const transcriptionInput = document.getElementById("transcription-text");
  
  let mediaRecorder;
  let audioChunks = [];
  
  recordButton.addEventListener("click", startRecording);
  stopButton.addEventListener("click", stopRecording);
  
  function startRecording() {
    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(function(stream) {
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.addEventListener("dataavailable", function(event) {
          audioChunks.push(event.data);
        });
        mediaRecorder.start();
        recordButton.disabled = true;
        stopButton.disabled = false;
      });
  }
  
  function stopRecording() {
    mediaRecorder.stop();
    recordButton.disabled = false;
    stopButton.disabled = true;
    const audioBlob = new Blob(audioChunks);
    audioChunks = [];
  
    const formData = new FormData();
    formData.append("audio_data", audioBlob);
    fetch("{% url 'transcribe_audio' %}", {
      method: "POST",
      body: formData,
      headers: {
        "X-CSRFToken": "{{ csrf_token }}",
      },
    })
    .then(function(response) {
      return response.json();
    })
    .then(function(data) {
      audioDataInput.value = JSON.stringify(data);
      transcriptionInput.value = data.transcription;
    });
  }
  </script>
</body>

{% endblock content%}




</html>




