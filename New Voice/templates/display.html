
{% block content%}
<!DOCTYPE html>
<html>
<head>
	<title>Transcribe Audio</title>
</head>
<body>
	<button id="start-button">Start Recording</button>
	<form id="audio-form">
		<input type="hidden" id="audio-data" name="audio_data">
		<textarea rows="4" cols="50">
			{% for transcription in transcriptions %}
    			<h3>Transcription {{ transcription.transcription}}</h3>
    			<p>{{ transcription.text }}</p>
			{% endfor %}

		</textarea>
			
		<button type="submit">Submit</button>
	</form>

	

	<script>
		var startButton = document.getElementById('start-button');

		// get the audio stream from the microphone when the start button is clicked
		startButton.addEventListener('click', function() {
			navigator.mediaDevices.getUserMedia({ audio: true })
			.then(function(stream) {
				// create a new MediaRecorder object
				var mediaRecorder = new MediaRecorder(stream);

				// create an empty buffer to store the audio data
				var chunks = [];

				// add event listeners to handle the dataavailable and stop events
				mediaRecorder.addEventListener('dataavailable', function(event) {
					chunks.push(event.data);
				});

				mediaRecorder.addEventListener('stop', function() {
					// combine all the audio data into a single Blob object
					var audioBlob = new Blob(chunks, { type: 'audio/wav' });

					// convert the audio data to base64 string
					var reader = new FileReader();
					reader.readAsDataURL(audioBlob);
					reader.onloadend = function() {
						var base64data = reader.result.split(',')[1];

						// set the base64 string as the value of the hidden input field
						document.getElementById('audio-data').value = base64data;

						// submit the form
						document.getElementById('audio-form').submit();
					}
				});

				// start recording
				mediaRecorder.start();

				// stop recording after 10 minutes
				setTimeout(function() {
					mediaRecorder.stop();
					startButton.disabled = false;
				}, 600000); // 10 minutes in milliseconds
			})
			.catch(function(error) {
				console.log(error);
			});

			startButton.disabled = true;
		});

	</script>
</body>
</html>


{% endblock content%}

