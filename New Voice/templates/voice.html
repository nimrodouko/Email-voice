
<link rel="stylesheet"  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<button id="record-button">Record</button>
<input type="hidden" id="audio-data" name="audio_data">
<button id="stop-button">Stop</button>
<script>
const recordButton = document.getElementById('record-button');
   const stopButton = document.getElementById('stop-button');
   const audioDataInput = document.getElementById('audio-data');
   let mediaRecorder;
   let audioChunks = [];
   
   // Add event listener to record button
   recordButton.addEventListener('click', () => {
	 // Request access to user's microphone
	 navigator.mediaDevices.getUserMedia({ audio: true })
	   .then((stream) => {
		 // Start recording audio stream
		 mediaRecorder = new MediaRecorder(stream);
		 mediaRecorder.addEventListener('dataavailable', (event) => {
		   audioChunks.push(event.data);
		 });
		 mediaRecorder.start();
	   });
   });
   
   // Add event listener to stop button
   stopButton.addEventListener('click', () => {
	 // Stop recording audio
	 mediaRecorder.stop();
	 console.log('Stop button clicked')
	 
   
	 // Convert audio chunks to a Blob
	 const audioBlob = new Blob(audioChunks);
	 console.log(audioBlob)
   
	 // Create a FormData object to send the audio blob to the server
	 const formData = new FormData();
	 formData.append('audio_data', audioBlob);
	 console.log(formData.get('audio_data'))
   
	 // Send the audio data to the server using AJAX
	 const xhr = new XMLHttpRequest();
	 xhr.open('POST', '/transcribe_audio/');
	 xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}'); // add this line if using CSRF protection
	 xhr.onload = () => {
	   if (xhr.status === 200) {
		 const data = JSON.parse(xhr.responseText);
		 console.log(data.transcription);
		 console.log(data.word_timings);
	   }
	 };
	 xhr.send(formData);
	console.log(xhr)
   });
   
   </script>